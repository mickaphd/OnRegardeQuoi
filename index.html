<!-- OnRegardeQuoi: a free, open-source, and minimalist web app for discovering movies and TV shows -->
<!-- Made with ❤ by micka from Paris -->
<!-- v1.1 -->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0 maximum-scale=1.0, user-scalable=no">
    <title>OnRegardeQuoi</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Slackey&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="ressources/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="ressources/favicon.svg" />
    <link rel="shortcut icon" href="ressources/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="ressources/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="OnRegardeQuoi" />
    <link rel="manifest" href="ressources/site.webmanifest" />

    <script src="https://cdn.tailwindcss.com"></script>

    <style>

        /*
        ========================================
        1. GLOBAL STYLES & THEME VARIABLES
        ========================================
        */

        :root {
            --amber-400: #FBBF24;
            --gray-700: #374151;
            --gray-400: #9CA3AF;
            --bg-color: #080808;
        }

        html {
            overflow-y: scroll;
        }

        body {
            background-color: var(--bg-color);
            color: #fff;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        .font-slackey {
            font-family: 'Slackey', cursive;
        }

        /*
        ========================================
        2. UI COMPONENT STYLES
        ========================================
        */
        
        /* Header & Navigation */

        header {
            transform: translate3d(0, 0, 0);
        }
        
        .nav-button.active {
            background-color: var(--amber-400);
            color: #000;
        }
        .nav-button.active:hover {
            background-color: var(--amber-400); 
        }

        /* Custom utility to hide scrollbars */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        /* Poster Cards */
        .poster-container {
            transition: transform 0.1s ease;
        }
        .poster-container:hover {
            transform: scale(1.05);
            z-index: 10;
        }
        .poster-container .poster {
            transition: box-shadow 0.1s ease;
        }
        .poster-container:hover .poster,
        .poster-container.show-overlay .poster {
            box-shadow: 0 0 0 2px var(--amber-400);
        }

        /* Modals & Overlays */
        .video-player-wrapper {
            box-shadow: 0 0 0 2px var(--amber-400);
        }
        .modal-glass-effect {
            background-color: rgba(30, 30, 30, 0.7);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #video-modal, #trailer-list-modal, #info-modal, #app-info-modal {
            height: 100svh;
        }
        #trailer-list-content .video-item:hover {
            background-color: rgba(251, 191, 36, 1);
            color: #fff;
        }

        /* Floating "Load More" Button */
        #load-more-container {
            position: fixed;
            bottom: 2rem;
            right: 1.5rem;
            z-index: 20;
        }
        .glass-button {
            background-color: rgba(55, 65, 81, 0.5);
            -webkit-backdrop-filter: blur(8px);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            padding: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .glass-button:hover:not(:disabled) {
            background-color: var(--amber-400);
            transform: scale(1.1);
        }
        .glass-button:hover:not(:disabled) svg {
            color: #000;
        }
        .glass-button.loading svg {
            animation: spin 1s linear infinite;
        }

        /*
        ========================================
        3. ANIMATIONS & TRANSITIONS
        ========================================
        */
        
        /* Logo effect on hover */
        .logo-effect {
            transition: filter 0.1s ease, transform 0.1s ease;
        }
        #open-app-info-btn:hover .logo-effect {
            color: white;
            transition: color 0.3s ease;
        }
        
        /* --- POSTER OVERLAY LOGIC --- */
        /* 1. Default State (for Touch): Everything is hidden and unclickable. */
        .poster-overlay, .play-icon, .options-icon, .info-icon {
            opacity: 0;
            transform: scale(0.8);
            pointer-events: none; /* Crucial: Prevents tapping invisible buttons */
            transition: all 0.3s ease;
        }

        /* 2. Active State (for Touch): JS adds '.show-overlay' to reveal. */
        .poster-container.show-overlay .poster-overlay,
        .poster-container.show-overlay .play-icon,
        .poster-container.show-overlay .options-icon,
        .poster-container.show-overlay .info-icon {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto; /* Buttons are now clickable */
        }

        /* 3. Enhancement (for Mouse): Automatically reveal on hover. */
        @media (hover: hover) {
            .poster-container:hover .poster-overlay,
            .poster-container:hover .play-icon,
            .poster-container:hover .options-icon,
            .poster-container:hover .info-icon {
                opacity: 1;
                transform: scale(1);
                pointer-events: auto;
            }
        }
    </style>
</head>

<body>

    <header class="p-4 sm:py-2 sm:px-6 lg:px-8 flex items-center justify-between fixed top-0 w-full bg-black/10 backdrop-blur-md z-30">

        <button id="open-app-info-btn" class="flex items-center flex-shrink-0 focus:outline-none cursor-pointer">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 805 502" aria-label="OnRegardeQuoi logo" class="h-14 w-auto text-amber-400 mr-1 logo-effect">
                <g transform="translate(0 502) scale(.1 -.1)" fill="currentColor"><path d="M6813 4800c-57-12-91-31-136-77-33-35-87-143-71-143 3 0 49-11 101-25 53-14 96-24 97-23 1 2 7 15 14 31 14 32 67 67 103 67 44 0 94-40 97-80 5-52-15-76-102-121-141-73-167-100-192-207-12-50-11-52 9-57 12-2 53-11 90-20 38-8 74-15 81-15 8 0 19 20 26 45 15 53 40 76 127 115 88 40 128 74 158 133 51 104 20 234-73 304-75 57-236 92-329 73zM358 4653c-14-9-31-27-37-40-8-17-11-435-11-1384v-1361l35-35c20-20 42-33 52-31 17 3 18 74 21 1436 2 1359 1 1432-15 1432-10 0-30-8-45-17zM497 4656c-10-25-8-2828 1-2844 7-10 304-12 1453-10l1444 3-55 34c-30 19-87 58-127 87l-73 54h-1244c-684 0-1252 3-1261 6-46 18-45-16-45 1294 0 1061 2 1235 15 1259 14 28 40 45 54 37 8-5 700-39 1136-56 154-6 642-26 1085-45 443-19 913-39 1045-45 267-10 265-10 265-82v-37l38 21c49 29 52 34 52 95 0 69-13 80-102 87-110 9-937 45-2113 91-214 9-568 24-785 35-217 11-481 23-586 26-175 7-191 6-197-10zM4464 4630c-26-10-40-44-59-145-22-118-25-111 59-129 108-24 146-66 146-160 0-32 6-48 24-65 31-29 56-81 56-116 0-14-9-48-21-75-19-45-20-50-5-78 23-45 20-103-7-143-49-73-125-97-204-64-27 11-39 12-49 4-27-22-15-57 36-108 56-56 66-82 51-137-16-59-46-100-89-125-35-20-41-31-66-108-48-149-97-206-244-280-62-31-62-32-46-54 10-12 44-44 76-72 32-27 58-55 58-62 0-6-14-13-32-15-17-2-33-8-35-14-6-17 55-87 142-165 109-97 114-100 211-114 90-14 164-50 164-82 0-14-9-15-71-9-77 7-139 20-454 95-231 56-342 87-350 101-3 4 12 17 32 27l38 18 110 330c104 314 142 404 168 406 7 1 37 2 67 4 84 4 175 33 215 69 28 24 36 39 37 68 2 54-21 75-88 80-33 3-60 11-65 19-26 42 10 142 67 185 36 28 42 29 149 19 63-6 72-5 93 14 44 43 19 107-54 137-49 21-150 17-203-6-75-35-112-20-67 25 37 37 124 75 172 75 22 0 62-7 89-17l48-16 24 27c31 36 29 59-7 89-74 63-181 63-278 2-102-65-111-70-118-63-14 14 8 60 46 97 71 68 153 96 233 79 40-8 51-7 58 3 16 25 9 58-13 73-26 16-99 30-143 27-47-3-145-54-202-105-71-64-115-134-245-390l-111-219-155-161c-283-295-410-438-480-541-99-148-236-432-244-509-2-24 1-29 22-33 41-6 56-27 42-58-8-18-9-32-2-45 18-34 132-120 366-278 314-210 461-297 766-452 276-140 287-149 309-235 14-56 7-312-16-610-8-104-12-192-7-196 20-21 433-124 627-158 283-48 360-55 655-55 305-1 437 11 690 60 127 25 400 98 434 116 18 10 19 22 13 252-15 600-143 1121-334 1354-55 67-180 169-260 214-70 38-84 57-65 83 4 6 52 37 107 69 98 58 225 172 300 270 31 40 25 56-21 56-12 0-27 6-34 14-9 12-4 20 32 45 74 51 98 72 98 84 0 7-24 24-53 40-143 74-209 178-288 455l-32 114 37 116c62 197 79 304 80 492 0 172-4 199-55 417-29 125-32 132-61 144-26 11-36 9-81-13-87-43-260-209-378-363-25-33-72-104-103-158-32-54-64-101-71-103-7-3-39 2-72 10-104 27-248 31-377 11-62-10-121-15-129-12-8 3-37 45-64 94-105 189-298 420-414 496-61 40-94 50-125 37zM1390 4230v-140h98c53 0 114-3 135-6l37-7v280l-77 7c-42 3-102 6-135 6h-58v-140zM2010 4210v-140h270v267l-77 7c-42 3-102 6-135 6h-58v-140zM2650 4191v-141h260v270h-38c-22 0-80 3-130 6l-92 7v-142zM3280 4175v-135h38c22 0 80-3 130-6l92-7v270l-61 7c-34 3-93 6-130 6h-69v-135zM7335 4127c-48-23-139-111-133-129 2-4 41-30 88-57l85-49 38 34c44 41 80 44 128 11 91-61 44-156-85-172-132-17-190-48-236-128-16-28-30-58-30-64 0-10 166-103 184-103 2 0 9 13 16 29 21 53 51 70 156 92 149 32 193 60 233 149 28 61 28 150 1 206-50 103-197 194-325 201-59 3-78 0-120-20zM6701 4034c-39-33-54-84-38-131 17-51 57-78 118-78 41 0 53 5 79 30 79 80 25 205-88 205-29 0-49-7-71-26zM1392 3743l3-138 133-3 133-3-3 138-3 138-133 3-133 3 3-138zM2010 3726v-134l128-4c70-2 130-3 135-1 4 3 7 65 7 139v134h-270zM2648 3843c-2-4-4-66-4-138l1-130 133-3 132-3v271h-107c-60 0-118 3-129 6-12 3-24 2-26-3zM3280 3696v-135l129-3 130-3 3 130c2 72 2 133 0 138-2 4-61 7-133 7h-129v-134zM7119 3435c-15-8-34-31-44-51-32-67 3-144 75-165 68-21 132 14 150 81 28 103-85 187-181 135zM1390 3250v-140h270v280h-270v-140zM2010 3240v-140h270v134c0 113-2 135-16 140-9 3-69 6-135 6h-119v-140zM2640 3226v-133l68-6c37-4 97-7 135-7h67v280h-270v-134zM1390 2760v-140h270v280h-270v-140zM2010 2750v-140h270v280h-270v-140zM2642 2743l3-138 133-3 132-3v268l-61 7c-34 3-95 6-136 6h-74l3-137zM6832 2603c-26-10-312-477-312-510 0-5 12-20 26-34 14-13 42-46 62-73l35-48 15 38c16 42 56 102 82 121 51 39 142 21 209-42l47-44 116 177c64 97 119 187 123 200 11 38-18 67-102 102-43 18-114 49-158 70-88 40-123 51-143 43zm78-133c27-27 25-56-5-76-23-15-27-15-50 0-29 19-32 51-8 78 21 23 38 23 63-2zm174-86c21-20 20-43-1-66-23-26-59-23-79 7-15 23-15 27 0 50 19 29 56 33 80 9zm-244-66c14-26 13-29-7-49-43-43-111 11-76 60 21 30 63 24 83-11zm135-54c23-9 37-51 25-73-14-28-38-33-71-16-21 12-29 23-29 43 0 45 30 63 75 46zm-230-50c20-20 16-63-8-78-23-15-71 12-75 42-7 47 48 70 83 36zM1390 2280v-140h270v280h-270v-140zM2010 2277v-134l128-6c70-2 131-2 135 2 4 4 6 66 5 137l-3 129-132 3-133 3v-134zM2646 2307c1-50 2-111 3-134l1-42h124c72-1 128 3 131 9 3 6-10 37-31 70-35 58-37 63-31 125l6 65h-204l1-93zM6784 2021c-34-21-60-74-75-156-9-48-7-59 32-156 23-57 53-155 67-216 15-62 31-113 37-112 14 1 225 271 252 322 12 23 24 63 28 89 8 56-10 149-34 179l-18 23-35-55c-66-102-86-103-117 0-30 99-70 123-137 82zM2340 1701c0-76 23-71-322-71h-310l-29-29c-17-17-29-40-29-55v-26h1730v24c0 83-14 86-379 86h-311l-5 23c-2 12-6 35-7 51l-3 28-167 5-168 4v-40z"/></g>
            </svg>
        </button>

            <h1 class="font-slackey text-xl tracking-tight hidden md:block">
                <span>On</span><span class="text-amber-400">Regarde</span><span>Quoi</span>
            </h1>

        <div class="flex-grow flex items-center justify-center relative mx-4 min-w-0">
            <div id="dock-container" class="grid items-center bg-gray-800/20 backdrop-blur-md border border-white/10 rounded-full p-1 transition-all duration-300 ease-in-out overflow-x-auto hide-scrollbar">

                <div id="nav-buttons-container" class="flex items-center gap-1 transition-opacity duration-300 col-start-1 row-start-1 flex-shrink-0">
                    <div class="flex items-center gap-1">

                        <button class="nav-button main-category-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200" data-section="movies" title="Movies"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M7 5V19M17 5V19M3 8H7M17 8H21M3 16H7M17 16H21M3 12H21M6.2 20H17.8C18.9201 20 19.4802 20 19.908 19.782C20.2843 19.5903 20.5903 19.2843 20.782 18.908C21 18.4802 21 17.9201 21 16.8V7.2C21 6.0799 21 5.51984 20.782 5.09202C20.5903 4.71569 20.2843 4.40973 19.908 4.21799C19.4802 4 18.9201 4 17.8 4H6.2C5.0799 4 4.51984 4 4.09202 4.21799C3.71569 4.40973 3.40973 4.71569 3.21799 5.09202C3 5.51984 3 6.07989 3 7.2V16.8C3 17.9201 3 18.4802 3.21799 18.908C3.40973 19.2843 3.71569 19.5903 4.09202 19.782C4.51984 20 5.07989 20 6.2 20Z" /></svg></button>

                        <button class="nav-button main-category-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200" data-section="tv" title="TV Shows"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21L12 17L17 21M7.8 17H16.2C17.8802 17 18.7202 17 19.362 16.673C19.9265 16.3854 20.3854 15.9265 20.673 15.362C21 14.7202 21 13.8802 21 12.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C21 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V12.2C3 13.8802 3 14.7202 3.32698 15.362C3.6146 15.9265 4.07354 16.3854 4.63803 16.673C5.27976 17 6.11984 17 7.8 17Z" /></svg></button>
                    
                    </div>

                    <div id="search-separator" class="w-px h-6 bg-white/20 mx-1 transition-opacity"></div>

                    <div id="shared-subcategories" class="flex items-center gap-1">

                        <button class="nav-button sub-category-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200" data-category="trending" title="Trending Now"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0 3 2.48Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M12 18a3.75 3.75 0 0 0 .495-7.468 5.99 5.99 0 0 0-1.925 3.547 5.975 5.975 0 0 1-2.133-1.001A3.75 3.75 0 0 0 12 18Z" /></svg></button>

                        <button class="nav-button sub-category-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200" data-category="soon" title="Coming Soon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg></button>

                        <button class="nav-button sub-category-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200" data-category="greats" title="All-Time Greats"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M11.2691 4.41115C11.5006 3.89177 11.6164 3.63208 11.7776 3.55211C11.9176 3.48263 12.082 3.48263 12.222 3.55211C12.3832 3.63208 12.499 3.89177 12.7305 4.41115L14.5745 8.54808C14.643 8.70162 14.6772 8.77839 14.7302 8.83718C14.777 8.8892 14.8343 8.93081 14.8982 8.95929C14.9705 8.99149 15.0541 9.00031 15.2213 9.01795L19.7256 9.49336C20.2911 9.55304 20.5738 9.58288 20.6997 9.71147C20.809 9.82316 20.8598 9.97956 20.837 10.1342C20.8108 10.3122 20.5996 10.5025 20.1772 10.8832L16.8125 13.9154C16.6877 14.0279 16.6252 14.0842 16.5857 14.1527C16.5507 14.2134 16.5288 14.2807 16.5215 14.3503C16.5132 14.429 16.5306 14.5112 16.5655 14.6757L17.5053 19.1064C17.6233 19.6627 17.6823 19.9408 17.5989 20.1002C17.5264 20.2388 17.3934 20.3354 17.2393 20.3615C17.0619 20.3915 16.8156 20.2495 16.323 19.9654L12.3995 17.7024C12.2539 17.6184 12.1811 17.5765 12.1037 17.56C12.0352 17.5455 11.9644 17.5455 11.8959 17.56C11.8185 17.5765 11.7457 17.6184 11.6001 17.7024L7.67662 19.9654C7.18404 20.2495 6.93775 20.3915 6.76034 20.3615C6.60623 20.3354 6.47319 20.2388 6.40075 20.1002C6.31736 19.9408 6.37635 19.6627 6.49434 19.1064L7.43410 14.6757C7.46898 14.5112 7.48642 14.429 7.47814 14.3503C7.47081 14.2807 7.44894 14.2134 7.41394 14.1527C7.37439 14.0842 7.31195 14.0279 7.18708 13.9154L3.82246 10.8832C3.40005 10.5025 3.18884 10.3122 3.16258 10.1342C3.13978 9.97956 3.19059 9.82316 3.29993 9.71147C3.42581 9.58288 3.70856 9.55304 4.27406 9.49336L8.77835 9.01795C8.94553 9.00031 9.02911 8.99149 9.10139 8.95929C9.16534 8.93081 9.22260 8.8892 9.26946 8.83718C9.32241 8.77839 9.35663 8.70162 9.42508 8.54808L11.2691 4.41115Z" /></svg></button>
                    
                    </div>
                    
                    <div id="search-separator" class="w-px h-6 bg-white/20 mx-1 transition-opacity"></div>

                    <div class="flex items-center gap-1">
                        <button id="search-toggle-btn" class="nav-button p-2 rounded-full text-gray-300 hover:bg-gray-600/50 hover:text-white transition-colors duration-200 flex-shrink-0" title="Toggle Search">
                            <svg id="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" /></svg>
                        </button>
                    </div>
                </div>

                <div id="search-input-container" class="hidden relative items-center w-full col-start-1 row-start-1">
                    <input id="new-search-field-input" type="text" placeholder="Search..." class="bg-transparent focus:outline-none text-white w-full py-2 px-4">
                    <button id="close-search-btn" class="hidden absolute p-1 rounded-full text-gray-400 hover:text-white hover:bg-gray-700/50 transition-colors duration-200 focus:outline-none ml-2 flex-shrink-0" title="Close Search" style="top: 50%; transform: translateY(-50%);">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>


    <main id="main-content" class="pt-24 px-4 pb-4 sm:px-6 sm:pb-6 lg:px-8 lg:pb-8"></main>

    <div id="load-more-container"></div>

    <div id="video-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-40 opacity-0 pointer-events-none p-4 cursor-pointer">
        <div class="w-full max-w-4xl aspect-video cursor-default rounded-lg overflow-hidden video-player-wrapper">
            <iframe id="video-player" class="w-full h-full" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
    </div>

    <div id="trailer-list-modal" class="fixed inset-0 bg-black/80 flex items-start justify-center z-40 opacity-0 pointer-events-none p-4">
        <div id="trailer-list-container" class="rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] flex flex-col modal-glass-effect mt-12">
            <div class="p-4 border-b border-gray-700/50 flex justify-between items-center flex-shrink-0">
                <h2 id="trailer-list-title" class="text-xl font-bold text-white">Available Videos</h2>
            </div>
            <div id="trailer-list-content" class="overflow-y-auto text-white text-sm p-2"></div>
        </div>
    </div>

    <div id="info-modal" class="fixed inset-0 bg-black/80 flex items-start justify-center z-40 opacity-0 pointer-events-none p-4">
        <div id="info-modal-container" class="rounded-lg shadow-lg w-full max-w-lg max-h-[80vh] flex flex-col modal-glass-effect mt-12">
            <div class="p-4 border-b border-gray-700/50 flex justify-between items-center flex-shrink-0">
                <h2 id="info-modal-title" class="text-xl font-bold text-white">Details</h2>
            </div>
            <div id="info-modal-content" class="overflow-y-auto text-white text-sm p-4"></div>
        </div>
    </div>

    <div id="app-info-modal" class="fixed inset-0 bg-black/80 flex items-start justify-center z-40 opacity-0 pointer-events-none p-4">
        <div id="app-info-modal-container" class="rounded-lg shadow-lg w-[95vw] sm:max-w-lg max-h-[90vh] sm:max-h-[80vh] flex flex-col modal-glass-effect mt-8 sm:mt-12">
            <div class="p-4 border-b border-gray-700/50 flex justify-between items-center flex-shrink-0">
                <div class="flex">
                    <button id="about-tab-btn" class="py-2 px-4 font-semibold border-b-2 focus:outline-none">About</button>
                    <button id="whats-new-tab-btn" class="py-2 px-4 font-semibold border-b-2 focus:outline-none">Updates</button>
                    <button id="acknowledgment-tab-btn" class="py-2 px-4 font-semibold border-b-2 focus:outline-none">Acknowledgment</button>
                </div>
            </div>
            <div class="overflow-y-auto text-white text-sm p-4 flex-grow">
                <div id="about-content" class="tab-content">
                    <p class="mb-2"><b>OnRegardeQuoi</b> takes its name from the common French phrase "On regarde quoi ?", meaning "What are we watching?".<br>It's a free, open-source, and minimalist web app for discovering movies and TV shows through their trailers.<br>Feel free to visit the <a href="https://github.com/mickaphd/OnRegardeQuoi/" target="_blank" class="text-amber-400 hover:underline">GitHub</a> repository to learn more about the project. It's also the best place to report bugs or request new features.
                    <p class="mt-4 text-xs text-gray-400">
                    Made with ❤ by micka from Paris
                    </p>
                    <p class="mt-4 text-xs text-gray-400">
                        <a href="#" id="force-refresh-btn" class="opacity-20 hover:opacity-100 transition-opacity" title="Clear all cached movie and TV show data to access the latest content, even if it's unnecessary!">Refresh ↻</a>
                    </p>
                </div>

                <div id="whats-new-content" class="tab-content hidden">
                    <h3 class="text-lg font-bold mb-2">v1.1 (October 16, 2025)</h3>
                    <ul class="list-disc list-inside mb-4">
                        <li>New shortcuts for IMDb, Rotten Tomatoes and Metacritic</li>
                        <li>New favicons/icons for all browsers, devices and platforms</li>
                        <li>Implemented a "Smart Hover & Tap" model that feels more native and predictable on all devices (mobile, desktop, and hybrids)</li>
                        <li>Code cleaning and optimization</li>
                    </ul>
                    
                    <h3 class="text-lg font-bold mb-2">v1.0 (September 23, 2025)</h3>
                    <ul class="list-disc list-inside">
                        <li>Initial release with core movie/TV show browsing</li>
                        <li>Dynamic content loading and search functionality</li>
                        <li>Responsive and modern design adapted for all screen sizes</li>
                        <li>Persistent and time-based caching</li>
                    </ul>
                </div>

                <div id="acknowledgment-content" class="tab-content hidden">
                    <ul class="list-disc list-inside">
                    <li><a href="https://www.themoviedb.org/" target="_blank" class="text-amber-400 hover:underline">The Movie Database (TMDB)</a> for movie and TV show data</li>
                    <li><a href="https://vercel.com/" target="_blank" class="text-amber-400 hover:underline">Vercel</a> for seamless hosting and deployment</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    

    <script type="module">


        // -----------------------------------------------------------------------------
        // 1. CONFIGURATION & STATE MANAGEMENT
        // -----------------------------------------------------------------------------

        const LOCAL_DEV_API_KEY = '';
        const TMDB_DIRECT_BASE_URL = 'https://api.themoviedb.org/3';
        const VERCEL_PROXY_BASE_URL = '/api/tmdb-api';
        const POSTER_SIZE = window.innerWidth < 768 ? 'w342' : 'w500';
        const IMAGE_BASE_URL = `https://image.tmdb.org/t/p/${POSTER_SIZE}`;
        const YOUTUBE_EMBED_URL = 'https://www.youtube-nocookie.com/embed/';
        const CACHE_TTLS = {
            trending: 12 * 60 * 60 * 1000,
            soon:     24 * 60 * 60 * 1000,
            greats:   48 * 60 * 60 * 1000
        };
        const defaultAppData = {
            movies: { trending: { items: [], nextPage: 1, hasMore: true, timestamp: 0 }, soon: { items: [], nextPage: 1, hasMore: true, timestamp: 0 }, greats: { items: [], nextPage: 1, hasMore: true, timestamp: 0 } },
            tv: { trending: { items: [], nextPage: 1, hasMore: true, timestamp: 0 }, soon: { items: [], nextPage: 1, hasMore: true, timestamp: 0 }, greats: { items: [], nextPage: 1, hasMore: true, timestamp: 0 } }
        };

        const state = {
            appData: defaultAppData,
            activeSection: null,
            activeCategory: 'trending',
            debounceTimer: null,
            isSearching: false,
            textMeasureSpan: null
        };


        // -----------------------------------------------------------------------------
        // 2. DOM ELEMENT SELECTORS
        // -----------------------------------------------------------------------------
        
        const $ = (selector) => document.querySelector(selector);
        const mainEl = $('#main-content');
        const loadMoreContainerEl = $('#load-more-container');
        const dockContainer = $('#dock-container');
        const searchToggleBtn = $('#search-toggle-btn');
        const navButtonsContainer = $('#nav-buttons-container');
        const searchInputContainer = $('#search-input-container');
        const newSearchFieldInput = $('#new-search-field-input');
        const closeSearchBtn = $('#close-search-btn');
        const sharedSubcategoriesEl = $('#shared-subcategories');
        const searchSeparator = $('#search-separator');
        const videoModalEl = $('#video-modal');
        const videoPlayerEl = $('#video-player');
        const trailerListModalEl = $('#trailer-list-modal');
        const trailerListContentEl = $('#trailer-list-content');
        const trailerListTitleEl = $('#trailer-list-title');
        const infoModalEl = $('#info-modal');
        const infoModalContentEl = $('#info-modal-content');
        const infoModalTitleEl = $('#info-modal-title');
        const appInfoModalEl = $('#app-info-modal');
        const openAppInfoBtn = $('#open-app-info-btn');
        const aboutTabBtn = $('#about-tab-btn');
        const whatsNewTabBtn = $('#whats-new-tab-btn');
        const acknowledgmentTabBtn = $('#acknowledgment-tab-btn');
        const aboutContent = $('#about-content');
        const whatsNewContent = $('#whats-new-content');
        const acknowledgmentContent = $('#acknowledgment-content');
        const forceRefreshBtn = $('#force-refresh-btn');
        
        // -----------------------------------------------------------------------------
        // 3. API & CACHE MANAGEMENT
        // -----------------------------------------------------------------------------

        const getFormattedDate = (d=0, m=0, y=0) => {
            const date = new Date();
            date.setDate(date.getDate() + d);
            date.setMonth(date.getMonth() + m);
            date.setFullYear(date.getFullYear() + y);
            return date.toISOString().split('T')[0];
        };

        const apiParamsConfig = {
            movies: {
                trending: { 'primary_release_date.gte': getFormattedDate(-90), 'primary_release_date.lte': getFormattedDate(), 'vote_average.gte': 5, 'vote_count.gte': 100, 'sort_by': 'popularity.desc' },
                soon: { 'primary_release_date.gte': getFormattedDate(1), 'primary_release_date.lte': getFormattedDate(0, 6), 'sort_by': 'popularity.desc', 'with_original_language': 'en|fr' },
                greats: { 'sort_by': 'vote_average.desc', 'vote_count.gte': 5000 }
            },
            tv: {
                trending: { 'first_air_date.gte': getFormattedDate(0, -6), 'first_air_date.lte': getFormattedDate(), 'vote_average.gte': 5, 'vote_count.gte': 100, 'sort_by': 'popularity.desc' },
                soon: { 'first_air_date.gte': getFormattedDate(1), 'first_air_date.lte': getFormattedDate(0, 0, 1), 'sort_by': 'popularity.desc', 'with_original_language': 'en|fr' },
                greats: { 'sort_by': 'vote_average.desc', 'vote_count.gte': 2000 }
            }
        };

        const apiFetch = async (tmdbEndpoint, params = {}) => {
            try {
                const baseUrl = LOCAL_DEV_API_KEY ? TMDB_DIRECT_BASE_URL : VERCEL_PROXY_BASE_URL;
                if (LOCAL_DEV_API_KEY) {
                    const allParams = { api_key: LOCAL_DEV_API_KEY, language: 'en-US', ...params };
                    const url = new URL(baseUrl + tmdbEndpoint);
                    url.search = new URLSearchParams(allParams).toString();
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    return await response.json();
                } else {
                    const response = await fetch(baseUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ tmdbEndpoint, queryParams: params }),
                    });
                    if (!response.ok) throw new Error(`HTTP error: ${response.status}`);
                    return await response.json();
                }
            } catch (error) {
                console.error(`API fetch error for ${tmdbEndpoint}:`, error);
                return null;
            }
        };

        const getTrailers = async (type, id) => {
            const data = await apiFetch(`/${type}/${id}/videos`);
            if (!data?.results?.length) return [];
            const priority = (v) => {
                const n = v.name.toLowerCase();
                if (['trailer', 'teaser'].includes(v.type.toLowerCase()) && !['promo', 'spot', 'bts'].some(kw => n.includes(kw))) {
                    if (n.includes('official trailer')) return 5;
                    if (v.official) return 4;
                    if (v.type === 'Trailer') return 3;
                    return 2;
                }
                return 1;
            };
            return data.results.filter(v => v.site === 'YouTube').sort((a,b) => priority(b) - priority(a));
        };

        const getBestTrailer = async (type, id) => (await getTrailers(type, id))[0] || null;
        const getDetails = async (type, id) => await apiFetch(`/${type}/${id}`);
        const saveCache = () => localStorage.setItem('onregardequoi_cache', JSON.stringify(state.appData));
        const loadCache = () => {
            try {
                const cachedData = localStorage.getItem('onregardequoi_cache');
                if (cachedData) state.appData = JSON.parse(cachedData);
            } catch (error) {
                console.error("Failed to load cache:", error);
                state.appData = defaultAppData;
            }
        };
        const forceClearCache = () => {
            state.appData = JSON.parse(JSON.stringify(defaultAppData));
            saveCache();
            alert('Cache cleared. Reloading content...');
            fetchContent(false);
            closeModal(appInfoModalEl);
        };

        // -----------------------------------------------------------------------------
        // 4. UI RENDERING & MANAGEMENT
        // -----------------------------------------------------------------------------

        const updateCloseButtonPosition = () => {
            if (!state.textMeasureSpan) return;
            const typedText = newSearchFieldInput.value;
            const textToMeasure = typedText.length > 0 ? typedText : newSearchFieldInput.placeholder;
            state.textMeasureSpan.textContent = textToMeasure;
            const textWidth = state.textMeasureSpan.offsetWidth;
            const inputPaddingLeft = parseFloat(window.getComputedStyle(newSearchFieldInput).paddingLeft);
            closeSearchBtn.style.left = `${inputPaddingLeft + textWidth}px`;
        };

        const createTextMeasurementSpan = () => {
            const span = document.createElement('span');
            const inputStyle = window.getComputedStyle(newSearchFieldInput);
            Object.assign(span.style, {
                fontFamily: inputStyle.fontFamily, fontSize: inputStyle.fontSize,
                fontWeight: inputStyle.fontWeight, letterSpacing: inputStyle.letterSpacing,
                position: 'absolute', visibility: 'hidden', height: 'auto',
                width: 'auto', whiteSpace: 'pre'
            });
            document.body.appendChild(span);
            state.textMeasureSpan = span;
        };

        const createPosterHTML = (item) => {
            const type = item.media_type || (item.title ? 'movie' : 'tv');
            const title = item.title || item.name;
            const year = (item.release_date || item.first_air_date || '').substring(0, 4);
            const tooltip = `${title}${year ? ` (${year})` : ''}`;
            let badgeHTML = '';
            if (item.media_type) {
                const icon = item.media_type === 'movie' 
                    ? `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-black"><path stroke-linecap="round" stroke-linejoin="round" d="M7 5V19M17 5V19M3 8H7M17 8H21M3 16H7M17 16H21M3 12H21M6.2 20H17.8C18.9201 20 19.4802 20 19.908 19.782C20.2843 19.5903 20.5903 19.2843 20.782 18.908C21 18.4802 21 17.9201 21 16.8V7.2C21 6.0799 21 5.51984 20.782 5.09202C20.5903 4.71569 20.2843 4.40973 19.908 4.21799C19.4802 4 18.9201 4 17.8 4H6.2C5.0799 4 4.51984 4 4.09202 4.21799C3.71569 4.40973 3.40973 4.71569 3.21799 5.09202C3 5.51984 3 6.07989 3 7.2V16.8C3 17.9201 3 18.4802 3.21799 18.908C3.40973 19.2843 3.71569 19.5903 4.09202 19.782C4.51984 20 5.07989 20 6.2 20Z" /></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 text-black"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21L12 17L17 21M7.8 17H16.2C17.8802 17 18.7202 17 19.362 16.673C19.9265 16.3854 20.3854 15.9265 20.673 15.362C21 14.7202 21 13.8802 21 12.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C21 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V12.2C3 13.8802 3 14.7202 3.32698 15.362C3.6146 15.9265 4.07354 16.3854 4.63803 16.673C5.27976 17 6.11984 17 7.8 17Z" /></svg>`;
                badgeHTML = `<div class="absolute top-2 right-2 p-1.5 bg-white/90 backdrop-blur-sm rounded-full z-10" title="${item.media_type === 'movie' ? 'Movie' : 'TV Show'}">${icon}</div>`;
            }
            return `<div class="poster-container" data-id="${item.id}" data-type="${type}" data-title="${title}" title="${tooltip}">
                <div class="poster relative rounded-lg overflow-hidden shadow-lg bg-gray-900 aspect-[2/3]">
                    ${badgeHTML}
                    <img src="${IMAGE_BASE_URL}${item.poster_path}" alt="${title}" class="w-full h-full object-cover" loading="lazy" onerror="this.src='https://placehold.co/500x750/0f0f0f/444444?text=Img+Error'">
                    <div class="poster-overlay absolute inset-0 flex items-center justify-center">
                        <button data-action="play" class="group cursor-pointer" title="Play Trailer">
                            <svg class="play-icon w-16 h-16 text-white group-hover:text-amber-400 transition-colors" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.8));" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path>
                            </svg>
                        </button>
                        
                        <button data-action="options" class="absolute bottom-2 right-2 p-1.5 bg-white/90 hover:bg-amber-400 rounded-full cursor-pointer backdrop-blur-sm transition-colors" title="Find More Videos">
                            <svg class="options-icon w-3 h-3 text-black" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48" fill="currentColor">
                                <circle cx="25" cy="8" r="6"/>
                                <circle cx="25" cy="24" r="6"/>
                                <circle cx="25" cy="40" r="6"/>
                            </svg>
                        </button>
                        
                        <button data-action="info" class="absolute bottom-2 left-2 p-1.5 bg-white/90 hover:bg-amber-400 rounded-full cursor-pointer backdrop-blur-sm transition-colors" title="More Information">
                            <svg class="info-icon w-3 h-3 text-black" xmlns="http://www.w3.org/2000/svg" viewBox="150 0 250 550" fill="currentColor">
                                <path d="M290.671,135.434c37.324-3.263,64.949-36.175,61.663-73.498c-3.241-37.324-36.152-64.938-73.476-61.675 c-37.324,3.264-64.949,36.164-61.686,73.488C220.437,111.096,253.348,138.698,290.671,135.434z"/>
                                <path d="M311.31,406.354c-16.134,5.906-43.322,22.546-43.322,22.546s20.615-95.297,21.466-99.446 c8.71-41.829,33.463-100.86-0.069-136.747c-23.35-24.936-53.366-18.225-79.819,7.079c-17.467,16.696-26.729,27.372-42.908,45.322 c-6.55,7.273-9.032,14.065-5.93,24.717c3.332,11.515,16.8,17.226,28.705,12.871c16.134-5.895,43.3-22.534,43.3-22.534 s-12.595,57.997-18.869,87c-0.874,4.137-36.06,113.292-2.505,149.18c23.35,24.949,53.343,18.226,79.819-7.066 c17.467-16.698,26.729-27.373,42.908-45.334c6.55-7.263,9.009-14.054,5.93-24.706C336.66,407.733,323.215,402.01,311.31,406.354z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>`;
        };
        
        const renderContent = (itemsToRender) => {
            if (!itemsToRender) return;
            let grid = mainEl.querySelector('.grid');
            if (!grid) {
                grid = document.createElement('div');
                grid.className = 'grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-4 sm:gap-5';
                mainEl.innerHTML = '';
                mainEl.appendChild(grid);
            }
            grid.innerHTML = itemsToRender.map(createPosterHTML).join('');
        };
        
        const setupLoadMoreButton = () => {
            if ($('#load-more-btn')) return;
            const button = document.createElement('button');
            button.id = 'load-more-btn';
            button.className = 'glass-button';
            loadMoreContainerEl.appendChild(button);
        };
        
        const resetLoadMoreButton = () => {
            const button = $('#load-more-btn');
            if (!button) return;
            button.classList.toggle('hidden', state.isSearching);
            if (state.isSearching) return;
            const cache = state.appData[state.activeSection][state.activeCategory];
            button.disabled = !cache.hasMore;
            button.classList.remove('loading');
            button.style.cursor = cache.hasMore ? 'pointer' : 'not-allowed';
            button.title = cache.hasMore ? 'Load More' : 'No more results';
            button.innerHTML = cache.hasMore 
                ? `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0Z" /></svg>` 
                : `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 0 0 5.636 5.636m12.728 12.728A9 9 0 1 1 5.636 5.636m12.728 12.728L5.636 5.636" /></svg>`;
        };

        const updateScrollShadows = () => {
            const el = dockContainer;
            const hasOverflow = el.scrollWidth > el.clientWidth;
            if (hasOverflow) {
                const atStart = el.scrollLeft < 5;
                const atEnd = el.scrollLeft > el.scrollWidth - el.clientWidth - 5;
                el.classList.toggle('show-left-shadow', !atStart);
                el.classList.toggle('show-right-shadow', !atEnd);
            } else {
                el.classList.remove('show-left-shadow', 'show-right-shadow');
            }
        };

        // -----------------------------------------------------------------------------
        // 5. MODAL & OVERLAY MANAGEMENT
        // -----------------------------------------------------------------------------

        const openModal = (modal) => modal.classList.remove('opacity-0', 'pointer-events-none');
        const closeModal = (modal) => modal.classList.add('opacity-0', 'pointer-events-none');
        const openTrailer = (videoKey) => {
            if (videoKey) {
                videoPlayerEl.src = `${YOUTUBE_EMBED_URL}${videoKey}?autoplay=1&controls=1&rel=0`;
                openModal(videoModalEl);
            }
        };
        const closeTrailer = () => {
            closeModal(videoModalEl);
            setTimeout(() => videoPlayerEl.src = 'about:blank', 300);
        };
        const showTrailerList = (title, trailers) => {
            trailerListTitleEl.textContent = `Videos for ${title}`;
            trailerListContentEl.innerHTML = trailers?.length 
                ? trailers.map(t => `<div class="video-item px-4 py-3 cursor-pointer flex justify-between items-center rounded-md" data-key="${t.key}" title="${t.name}"><span class="truncate pr-2">${t.name}</span><span class="video-type-tag text-xs bg-gray-700 text-gray-300 rounded px-1.5 py-0.5 whitespace-nowrap">${t.type}</span></div>`).join('') 
                : `<div class="p-4 text-gray-400">No videos found.</div>`;
            openModal(trailerListModalEl);
        };

        const showInfoModal = async (title, details, type, id) => {
            const encodedTitle = encodeURIComponent(title);
            const externalLinksHTML = `
                <a href="https://www.imdb.com/find/?q=${encodedTitle}" target="_blank" rel="noopener noreferrer" 
                   class="opacity-40 hover:opacity-100 transition-opacity ml-2" 
                   title="Search on IMDb">
                    <img src="ressources/imdb.svg" alt="IMDb" class="w-5 h-5 inline-block" style="filter: brightness(0) invert(1);">
                </a>
                <a href="https://www.rottentomatoes.com/search?search=${encodedTitle}" target="_blank" rel="noopener noreferrer" 
                   class="opacity-40 hover:opacity-100 transition-opacity ml-2" 
                   title="Search on Rotten Tomatoes">
                    <img src="ressources/rotten.svg" alt="Rotten Tomatoes" class="w-5 h-5 inline-block" style="filter: brightness(0) invert(1);">
                </a>
                <a href="https://www.metacritic.com/search/${encodedTitle}" target="_blank" rel="noopener noreferrer" 
                   class="opacity-40 hover:opacity-100 transition-opacity ml-2" 
                   title="Search on Metacritic">
                    <img src="ressources/metacritic.svg" alt="Metacritic" class="w-5 h-5 inline-block">
                </a>
            `;
            
            infoModalTitleEl.innerHTML = `Details for ${title} ${externalLinksHTML}`;
            
            let content = '<div class="text-gray-400">Details not available.</div>';
            if (details) {
                const credits = await apiFetch(`/${type}/${id}/credits`);
                const director = credits?.crew?.find(c => c.job === 'Director')?.name || 'N/A';
                const cast = credits?.cast?.slice(0, 5).map(a => a.name).join(', ') || 'N/A';
                const currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 });
                const infoMap = {
                    "Year": (details.release_date || details.first_air_date || '').substring(0, 4) || 'N/A',
                    "Genres": details.genres?.map(g => g.name).join(', ') || 'N/A',
                    "Runtime": details.runtime ? `${details.runtime} min` : (details.episode_run_time?.[0] ? `${details.episode_run_time[0]} min/ep` : 'N/A'),
                    "Rating": details.vote_average ? `${details.vote_average.toFixed(1)}/10 (${details.vote_count} votes)` : 'N/A', 
                    "Status": details.status || 'N/A', 
                    "Director": director, 
                    "Cast": cast,
                    "Budget": details.budget > 0 ? currencyFormatter.format(details.budget) : null, 
                    "Revenue": details.revenue > 0 ? currencyFormatter.format(details.revenue) : null,
                    "Production": details.production_companies?.map(c => c.name).join(', ') || null, 
                    "Seasons": type === 'tv' && details.number_of_seasons ? details.number_of_seasons : null,
                    "Episodes": type === 'tv' && details.number_of_episodes ? details.number_of_episodes : null,
                };
                
                content = Object.entries(infoMap).filter(([_, v]) => v && v !== 'N/A').map(([k, v]) => `<div><strong>${k}:</strong> <span class="text-gray-400">${v}</span></div>`).join('') + `<div class="mt-2"><strong>Synopsis:</strong> <span class="text-gray-400 leading-relaxed">${details.overview || 'No synopsis.'}</span></div>`;
            }
            infoModalContentEl.innerHTML = `<div class="space-y-2">${content}</div>`;
            openModal(infoModalEl);
        };

        const switchAppInfoTab = (activeTabId) => {
            const tabs = [ { id: 'about-tab-btn', btn: aboutTabBtn, content: aboutContent }, { id: 'whats-new-tab-btn', btn: whatsNewTabBtn, content: whatsNewContent }, { id: 'acknowledgment-tab-btn', btn: acknowledgmentTabBtn, content: acknowledgmentContent } ];
            tabs.forEach(tab => {
                const isActive = tab.id === activeTabId;
                tab.btn.classList.toggle('text-white', isActive);
                tab.btn.classList.toggle('text-gray-400', !isActive);
                tab.btn.classList.toggle('border-amber-400', isActive);
                tab.btn.classList.toggle('border-transparent', !isActive);
                tab.content.classList.toggle('hidden', !isActive);
            });
        };
        
        // -----------------------------------------------------------------------------
        // 6. CORE APPLICATION LOGIC
        // -----------------------------------------------------------------------------

        const fetchContent = async (append = false) => {
            if (state.isSearching) return;
            const mediaType = state.activeSection === 'movies' ? 'movie' : 'tv';
            const category = state.activeCategory;
            const cache = state.appData[state.activeSection][category];
            const isCacheStale = (Date.now() - cache.timestamp) > CACHE_TTLS[category];
            if (!append && cache.items.length > 0 && !isCacheStale) {
                renderContent(cache.items);
                resetLoadMoreButton();
                return;
            }
            if (!append && isCacheStale) {
                Object.assign(cache, { items: [], nextPage: 1, hasMore: true });
            }
            if (!cache.hasMore && append) return;
            const params = { ...apiParamsConfig[state.activeSection][category], page: cache.nextPage };
            const data = await apiFetch(`/discover/${mediaType}`, params);
            if (data?.results?.length > 0) {
                cache.items.push(...data.results.filter(item => item.poster_path));
                cache.nextPage++;
                cache.hasMore = data.page < data.total_pages;
                if (!append) cache.timestamp = Date.now();
            } else {
                cache.hasMore = false;
            }
            renderContent(cache.items);
            resetLoadMoreButton();
            saveCache();
        };

        const setActiveSection = async (section) => {
            if (state.isSearching || state.activeSection === section) return;
            state.activeSection = section;
            document.querySelectorAll('.main-category-button').forEach(b => b.classList.toggle('active', b.dataset.section === section));
            sharedSubcategoriesEl.querySelectorAll('.sub-category-button').forEach(b => b.classList.toggle('active', b.dataset.category === state.activeCategory));
            await fetchContent(false);
        };

        const openSearchBar = () => {
            state.isSearching = true;
            navButtonsContainer.classList.add('opacity-0', 'pointer-events-none');
            searchSeparator.classList.add('opacity-0', 'pointer-events-none');
            searchInputContainer.classList.remove('hidden');
            searchInputContainer.classList.add('flex');
            newSearchFieldInput.focus();
            mainEl.innerHTML = '';
            resetLoadMoreButton();
            closeSearchBtn.classList.remove('hidden');
            updateCloseButtonPosition();
        };

        const closeSearchBar = async () => {
            state.isSearching = false;
            searchInputContainer.classList.add('hidden');
            searchInputContainer.classList.remove('flex');
            navButtonsContainer.classList.remove('opacity-0', 'pointer-events-none');
            searchSeparator.classList.remove('opacity-0', 'pointer-events-none');
            newSearchFieldInput.value = '';
            closeSearchBtn.classList.add('hidden');
            await fetchContent(false);
        };

        const performSearch = async (query) => {
            clearTimeout(state.debounceTimer);
            if (!query) { mainEl.innerHTML = ''; return; }
            mainEl.innerHTML = '<div class="text-center text-gray-400">Searching...</div>';
            state.debounceTimer = setTimeout(async () => {
                const data = await apiFetch('/search/multi', { query });
                const results = data?.results.filter(i => (i.media_type === 'movie' || i.media_type === 'tv') && i.poster_path) ?? [];
                results.sort((a, b) => b.popularity - a.popularity);
                if (results.length > 0) renderContent(results);
                else mainEl.innerHTML = '<p class="text-center text-gray-400">No results found.</p>';
            }, 350);
        };


        // -----------------------------------------------------------------------------
        // 7. EVENT HANDLERS
        // -----------------------------------------------------------------------------
        const handlePosterClick = async (e) => {
            const poster = e.target.closest('.poster-container');
            if (!poster) return;

            const action = e.target.closest('[data-action]')?.dataset.action;
            const { id, type, title } = poster.dataset;

            // --- Action Logic ---
            // If a visible action button was clicked, perform the action.
            if (action) {
                poster.classList.remove('show-overlay'); // Hide overlay after action
                if (action === 'play') {
                    openTrailer((await getBestTrailer(type, id))?.key);
                } else if (action === 'options') {
                    showTrailerList(title, await getTrailers(type, id));
                } else if (action === 'info') {
                    showInfoModal(title, await getDetails(type, id), type, id);
                }
                return;
            }

            // --- Touch Reveal Logic ---
            // If the poster background was tapped, toggle the overlay.
            // (This has no effect on desktop, as hover already shows it).
            if (poster.classList.contains('show-overlay')) {
                poster.classList.remove('show-overlay');
            } else {
                // First, close any other open posters
                document.querySelectorAll('.poster-container.show-overlay').forEach(p => p.classList.remove('show-overlay'));
                // Then, open this one
                poster.classList.add('show-overlay');
            }
        };

        const handleCategoryClick = async (e) => {
            const button = e.target.closest('.sub-category-button');
            if (!button || button.classList.contains('active')) return;
            button.parentElement.querySelectorAll('.sub-category-button').forEach(b => b.classList.remove('active'));
            button.classList.add('active');
            state.activeCategory = button.dataset.category;
            await fetchContent(false);
        };


        // -----------------------------------------------------------------------------
        // 8. INITIALIZATION
        // -----------------------------------------------------------------------------

        const setupEventListeners = () => {
            document.querySelectorAll('.main-category-button').forEach(btn => btn.addEventListener('click', () => setActiveSection(btn.dataset.section)));
            sharedSubcategoriesEl.addEventListener('click', handleCategoryClick);

            searchToggleBtn.addEventListener('click', () => state.isSearching ? closeSearchBar() : openSearchBar());
            closeSearchBtn.addEventListener('click', closeSearchBar);
            
            newSearchFieldInput.addEventListener('input', () => {
                performSearch(newSearchFieldInput.value.trim());
                updateCloseButtonPosition();
            });

            mainEl.addEventListener('click', handlePosterClick);
            loadMoreContainerEl.addEventListener('click', e => e.target.closest('#load-more-btn') && fetchContent(true));
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.poster-container')) {
                    document.querySelectorAll('.poster-container.show-overlay').forEach(p => p.classList.remove('show-overlay'));
                }
            });

            [trailerListModalEl, infoModalEl, appInfoModalEl].forEach(modal => {
                modal.addEventListener('click', (e) => { if(e.target === modal) closeModal(modal) });
            });
            videoModalEl.addEventListener('click', (e) => { if(e.target === videoModalEl) closeTrailer() });

            openAppInfoBtn.addEventListener('click', () => openModal(appInfoModalEl));
            aboutTabBtn.addEventListener('click', () => switchAppInfoTab('about-tab-btn'));
            whatsNewTabBtn.addEventListener('click', () => switchAppInfoTab('whats-new-tab-btn'));
            acknowledgmentTabBtn.addEventListener('click', () => switchAppInfoTab('acknowledgment-tab-btn'));
            forceRefreshBtn.addEventListener('click', (e) => { e.preventDefault(); forceClearCache(); });
            trailerListContentEl.addEventListener('click', e => {
                const item = e.target.closest('[data-key]');
                if (item) { closeModal(trailerListModalEl); openTrailer(item.dataset.key); }
            });

            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    [videoModalEl, trailerListModalEl, infoModalEl, appInfoModalEl].forEach(closeModal);
                    closeTrailer();
                    if (state.isSearching) closeSearchBar();
                }
            });

            // Listeners for scroll shadow and resize
            dockContainer.addEventListener('scroll', updateScrollShadows);
            window.addEventListener('resize', () => {
                updateScrollShadows();
                updateCloseButtonPosition();
            });
        };

        const init = async () => {
            loadCache();
            setupLoadMoreButton();
            await setActiveSection('movies');
            createTextMeasurementSpan();
            setupEventListeners();
            switchAppInfoTab('about-tab-btn');
            updateScrollShadows(); // Initial check for scroll shadows
        };

        init();
    </script>
</body>
</html>



